<VirtualHost *:80>
ServerName carbonio.mit.edu
ServerAdmin webmaster@localhost

# Force all HTTP traffic to HTTPS for security
RewriteEngine On
RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]

</VirtualHost>

<VirtualHost *:443>
DocumentRoot /var/www/html

# --- WSGI Configuration ---

# 1. Define the Daemon Process Group
WSGIDaemonProcess labmonitordb-process user=www-data group=www-data threads=5

# 2. Tell the WSGI Script to use this defined process group
WSGIProcessGroup labmonitordb-process

# 3. Alias the URL path to the WSGI script.
WSGIScriptAlias /LabMonitorDB/api /var/www/LabMonitorDB/data_collector.wsgi

Alias /LabMonitorDB/static /var/www/LabMonitorDB/static

<Directory /var/www/LabMonitorDB/static>
    Require all granted
    </Directory>

<Location /LabMonitorDB/api>
    <IfModule mod_headers.c>
        Header always unset Content-Length
    </IfModule>
</Location>

# --- Directory access permissions for the WSGI script ---
<Directory /var/www/LabMonitorDB>
WSGIProcessGroup labmonitordb-process
WSGIApplicationGroup %{GLOBAL}
Require all granted

<LimitExcept POST OPTIONS>
    Require all denied
</LimitExcept>
</Directory>

# --- Error Logging ---
ErrorLog ${APACHE_LOG_DIR}/data_collector_error.log
CustomLog ${APACHE_LOG_DIR}/data_collector_access.log combined

# --- SSL/TLS Configuration ---
SSLEngine on
SSLCertificateFile /etc/letsencrypt/live/carbonio.mit.edu/cert.pem
SSLCertificateKeyFile /etc/letsencrypt/live/carbonio.mit.edu/privkey.pem

</VirtualHost>
